function Particle(e,t,n){this.x=e==undefined?0:e;this.y=t==undefined?0:t;this.radius=n==undefined?Settings.particle.shape.maxSize:n;this._radius=this.radius;this.scale=1;this.color=Settings.particle.shape.color;this._color=this.color;this.alpha=1;this._alpha=this.alpha;this.stage=null;this.drawLines=false;this.drawToNext=false}function Molecule(e,t,n){this.x=this._x=e==undefined?0:e;this.y=this._y=t==undefined?0:t;this.radius=n==undefined?Settings.particle.shape.maxSize:n;this._radius=this.radius;this._velocityX=0;this._velocityY=0;this.offsetX=0;this.offsetY=0;this.behavior=null}function distance(e,t){var n=0;var r=0;n=t.x-e.x;n=n*n;r=t.y-e.y;r=r*r;return Math.sqrt(n+r)}function hexToRgb(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?String(parseInt(t[1],16)+","+parseInt(t[2],16)+","+parseInt(t[3],16)):null}function angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)*180/Math.PI}function isOdd(e){return e%2}function Stage(e){this.canvas=e;this.context=e.getContext("2d");this.displayObjects=[];this.width=0;this.height=0;this.numChildren=0;this.trailing=0;this.responsiveScale=-1;this.animationFrame=0;this.animationFrameRate=0;this.animationLastRun;this.showFps=false;this.init()}function fireWorks(e){function n(){lightning();var e=Settings.particle.shape.minSize;var r=Settings.particle.shape.maxSize;var i=stage.numChildren;var s=Math.round(Math.random()*stage.width);var o=Math.round(Math.random()*stage.height);for(var u=0;u<t;u++){var a=e+Math.random()*(r-e);a*=stage.responsiveScale;a=a<1?1:a;var f=new Molecule(s,o,a);f.behavior=[];f.behavior.push(new ViberBehavior(Math.round(28*stage.responsiveScale)));stage.addChild(f)}for(var u=0;u<t;u++){var l=stage.getChildAt(i+u);var c=u/t*360;l.color="#FFFFFF";l.behavior=[];l.behavior.push(new ExplodeBehavior(5+Math.round(Math.random()*15),c,45,true));l.behavior.push(new ColorBehavior("#000000",10+Math.round(Math.random()*15)))}var h=50+Math.random()*40;stage.setTimeout(h,function(){if(fireFireworks==true){n()}})}var t=100;fireFireworks=true;stage.setTimeout(30,n);stage.setTimeout(100,function(){e()})}function lightning(){stage.flash();setTimeout(function(){stage.flash()},85)}function stopFireWorks(e){fireFireworks=false;stage.setTimeout(100,function(){e()})}function explodeBackground(){explode(30,0,initBackgroundMolecules)}function explodeForeground(){explode(30,initBackgroundMolecules)}function explode(e,t,n,r){var i=e==undefined?30:e;var s=t==undefined?0:t;var o=n==undefined?stage.numChildren:n;var u=r==undefined?{x:0,y:0}:r;for(var a=s;a<o;a++){var f=stage.getChildAt(a);var l=angle(u,f);f.behavior=new ExplodeBehavior(i/2+Math.random()*(i/2),l,280)}}function setBlackHole(e,t,n,r){function f(){if(a>i){var e=o;if(a-e<i){e=a-i}a-=e;for(var t=0;t<e;t++){var n=stage.getChildAt(a+t);n.target(u.x,u.y);n.behavior=[];n.behavior.push(new MorphBehavior);n.behavior.push(new GrowBehavior);n.behavior.push(new ViberBehavior(Math.round(15*stage.responsiveScale)))}requestAnimationFrame(function(){f()})}else{r();return}}var i=e==undefined?0:e;var s=t==undefined?stage.numChildren:t;var o=n==undefined?1:n;var u={x:0,y:0};var a=s;f()}function applyGravity(e,t,n){function o(){if(s>r){var t=e;if(s-t<r){t=s-r}s-=t;for(var n=0;n<t;n++){var i=stage.getChildAt(s+n);i.behavior=new GravityBehavior(i.radius*2,i.radius*8);i._velocityX=-10+Math.random()*20}requestAnimationFrame(function(){o()})}else{return}}var e=e==undefined?1:e;var r=t==undefined?0:t;var i=n==undefined?stage.numChildren:n;var s=i;o()}var Settings={canvas:{color:"#2d1622",trailing:0},particle:{lines:{enabled:true,range:100,rgb:hexToRgb("#7d3d5e")},shape:{enabled:true,color:"#862656",minSize:1,maxSize:3},backgroundShapes:{color:"#862656"}}};Particle.prototype={render:function(){if(this.stage){this.centerX=this.stage.canvas.width/2;this.centerY=this.stage.canvas.height/2;if(this.drawLines==true){if(Settings.particle.lines.enabled){for(var e=0;e<this.stage.numChildren;e++){var t=this.stage.displayObjects[e];if(t.drawLines==true){var n=distance(this,t);if(n<Settings.particle.lines.range){this.stage.context.strokeStyle="rgba("+Settings.particle.lines.rgb+","+.1*(1-n/Settings.particle.lines.range)+")";this.stage.context.lineWidth=2;this.stage.context.beginPath();this.stage.context.moveTo(this.centerX+this.x*this.scale,this.centerY+this.y*this.scale);this.stage.context.lineTo(this.centerX+t.x*t.scale,this.centerY+t.y*t.scale);this.stage.context.stroke()}}}}}if(Settings.particle.shape.enabled){this.stage.context.globalAlpha=this.alpha;this.stage.context.fillStyle=this.color;this.stage.context.beginPath();this.stage.context.arc(this.centerX+this.x*this.scale,this.centerY+this.y*this.scale,this.radius*this.scale,0,Math.PI*2,true);this.stage.context.closePath();this.stage.context.fill()}}},registerStage:function(e){if(!this.stage)this.stage=e}};Molecule.prototype=new Particle;Molecule.prototype.particleRender=Molecule.prototype.render;Molecule.prototype.render=function(){if(this.behavior){if(this.behavior.length!==undefined){for(var e=0;e<this.behavior.length;e++){this.behavior[e].behave(this)}}else{this.behavior.behave(this)}}this.particleRender()};Molecule.prototype.target=function(e,t,n){this._x=e!==null&&e!==undefined?e:this._x;this._y=t!==null&&t!==undefined?t:this._y;this._radius=n!==null&&n!==undefined?n:this._radius};Molecule.prototype.die=function(){this.stage.removeChild(this)};var ViberBehavior=function(e,t){this.name="viber";this.scope=e==undefined?5:e;this.free=t==undefined?false:true};ViberBehavior.prototype={behave:function(e){e.offsetX=Math.floor(Math.random()*this.scope-this.scope/2);e.offsetY=Math.floor(Math.random()*this.scope-this.scope/2);if(this.free){e.x=e._x+e.offsetX;e.y=e._y+e.offsetY}}};var WindBehavior=function(e,t){this.name="wind";this.speed=e==undefined?3:e;this.direction=t==undefined?45:t;this._direction=this.direction};WindBehavior.prototype={behave:function(e){e._velocityX=this.speed*Math.cos(this._direction*Math.PI/180)+e.offsetX;e._velocityY=this.speed*Math.sin(this._direction*Math.PI/180)+e.offsetY;e.x+=e._velocityX;e.y+=e._velocityY;if(this.direction!==this._direction){this._direction+=(this.direction-this._direction)/40}if(e.x>e.stage.width/2+e.radius){e.x-=e.stage.width+e.radius*2}else if(e.x<e.stage.width/-2){e.x+=e.stage.width+e.radius*2}if(e.y>e.stage.height/2+e.radius){e.y-=e.stage.height+e.radius*2}else if(e.y<e.stage.height/-2){e.y+=e.stage.height+e.radius*2}e._x=e.x;e._y=e.y}};var GravityBehavior=function(e,t){this.name="gravity";this.weight=e==undefined?.89:e;this.bounceRate=t==undefined?5:t};GravityBehavior.prototype={behave:function(e){if(e._velocityX>=.1){e._velocityX-=.05}else if(e._velocityX<=-.1){e._velocityX+=.05}if(e._velocityX!==0){e.x+=e._velocityX}if(e._velocityY<this.bounceRate&&this.bounceRate>this.weight){e._velocityY+=this.weight}if(e._velocityY!==0){e.y+=e._velocityY}if(e.y>e.stage.height/2+e.radius){e._velocityY*=-1;this.bounceRate/=1.7}if(this.bounceRate<=this.weight&&e._velocityY!==0){e._velocityY=0;e.y=e.stage.height/2-e.radius}if(e.x<e.stage.width/-2){e._velocityX*=-1}else if(e.x>e.stage.width/2){e._velocityX*=-1}e._x=e.x;e._y=e.y}};var BeatBehavior=function(e){this.name="beat";this.pike=e==undefined?3:e/2;this.beatScale=this.pike;this.beatSpeed=this.pike/10;this._radius=e};BeatBehavior.prototype={behave:function(e){if(this.beatScale>1){this.beatScale-=this.beatSpeed}else if(this.beatScale!==1){this.beatScale=1}e.radius=this._radius*this.beatScale}};var MorphBehavior=function(){this.name="morph";this.scale=1;this.targetX=0;this.targetY=0};MorphBehavior.prototype={behave:function(e){if(this.scale!==e.stage.responsiveScale){this.scale=e.stage.responsiveScale}this.targetX=e._x+e.offsetX;this.targetY=e._y+e.offsetY;if(distance(e,{x:this.targetX,y:this.targetY})>1*this.scale){e.x+=(this.targetX-e.x)/5;e.y+=(this.targetY-e.y)/5}}};var GrowBehavior=function(e,t,n){this.name="grow";this.maxSize=e==undefined?6:e;this.minSize=t==undefined?1:t;this.speed=n==undefined?.1:n;this.scale=-1};GrowBehavior.prototype={behave:function(e){if(this.scale!==e.stage.responsiveScale){this.scale=e.stage.responsiveScale;this.speed*=this.scale}if(e.radius>this.maxSize*this.scale){e.radius=this.maxSize*this.scale;this.speed*=-1}else if(e.radius<this.minSize*this.scale){e.radius=this.minSize*this.scale;this.speed*=-1}e.radius+=this.speed}};var ColorBehavior=function(e,t,n){this.name="color";this.color=e;this.until=t;this.elapsed=0;this.alpha=n==undefined?1:n};ColorBehavior.prototype={behave:function(e){if(this.elapsed>=0){this.elapsed++}if(this.elapsed>this.until){e.color=this.color;e.alpha=this.alpha;this.elapsed=-1}}};var ExplodeBehavior=function(e,t,n,r){this.name="explode";this.explode=e!==undefined?e:10;this.direction=t!==undefined?t:Math.floor(Math.random()*360);this.windDirection=n!==undefined?n:280;this.scale=-1;this.deceleration=.2;this.randomRadius=1+Math.random()*2;this.mustDie=r!==undefined?r:false};ExplodeBehavior.prototype={behave:function(e){if(this.scale!==e.stage.responsiveScale){this.scale=e.stage.responsiveScale;this.explode*=this.scale;this.deceleration*=this.scale}e._velocityX=this.explode*Math.cos(this.direction*Math.PI/180);e._velocityY=this.explode*Math.sin(this.direction*Math.PI/180);e.x+=e._velocityX;e.y+=e._velocityY;if(this.explode>this.deceleration){this.explode-=this.deceleration;e.radius+=(e._radius-e.radius)/10}else if(this.explode!==0){this.explode=0;e.radius=e._radius;if(this.mustDie==true){e.die()}else{e.behavior=new WindBehavior(e.radius/3,this.windDirection)}}if(e.x>e.stage.width/2+e.radius){e.x-=e.stage.width+e.radius*2}else if(e.x<e.stage.width/-2){e.x+=e.stage.width+e.radius*2}if(e.y>e.stage.height/2+e.radius){e.y-=e.stage.height+e.radius*2}else if(e.y<e.stage.height/-2){e.y+=e.stage.height+e.radius*2}}};var LineBehavior=function(e){this.name="line";this.forceRelative=e;this.level=0;this.t=0;this.e=2.718281828459;this.gedempte=89;this.isSet=false;this._amp=550;this._cond=400;this._feed=-10;this.step=0};LineBehavior.prototype={behave:function(e){if(!this.isSet){this.amp=this._amp*this.step*e.stage.responsiveScale;this.cond=this._cond*this.step*e.stage.responsiveScale;this.feed=this._feed*this.step*e.stage.responsiveScale;this.isSet=true}if(this.t>0){this.t+=.005;this.level=-1*Math.pow(this.e,this.feed*this.t)*(this.amp*this.forceRelative*Math.cos(this.gedempte*this.t)+this.cond*this.forceRelative*Math.sin(this.gedempte*this.t))}this.targetX=e._x+e.offsetX;this.targetY=e._y+e.offsetY+this.level;e.x+=(this.targetX-e.x)/5;e.y+=(this.targetY-e.y)/5},pulse:function(e){if(e>=0&&e<=1){this.step=e}else{this.step=0}this.isSet=false;this.level=0;this.t=.1}};var DieOutBehavior=function(){this.name="dieOut"};DieOutBehavior.prototype={behave:function(e){e.x+=e._velocityX;e.y+=e._velocityY;if(Number(e.radius.toFixed(1))>0){e.radius=Number(e.radius.toFixed(1))-.1}if(Number(e.alpha.toFixed(1))>0){e.alpha-=.02}else{e.die()}}};Stage.prototype={init:function(){this.fps=60;this.displayMax=600;this.engine()},engine:function(){var e=this;if(!e.animationLastRun){e.animationLastRun=(new Date).getTime();requestAnimationFrame(function(){e.engine()});return}var t=((new Date).getTime()-e.animationLastRun)/1e3;e.animationLastRun=(new Date).getTime();e.animationFrameRate=1/t;setTimeout(function(){e.animationFrame=requestAnimationFrame(function(){e.engine()});e.render();if(e.showFps){document.getElementById("framerateDiv").innerHTML="frame: "+Math.floor(e.animationFrame);document.getElementById("framerateDiv").innerHTML+="<br/>"+"fps: "+Math.floor(e.animationFrameRate);document.getElementById("framerateDiv").innerHTML+="<br/>"+"w: "+e.width;document.getElementById("framerateDiv").innerHTML+="<br/>"+"h: "+e.height}},1e3/this.fps)},frameHandler:function(e){e.stage.render()},render:function(){this.width=this.canvas.width;this.height=this.canvas.height;if(this.responsiveScale==-1){this.setScale();this.getAverages();Settings.particle.lines.range*=this.responsiveScale}if(this.trailing==0||this.trailing>1){this.context.clearRect(0,0,this.width,this.height)}else{this.context.globalAlpha=1-this.trailing;this.context.fillStyle=Settings.canvas.color;this.context.fillRect(0,0,this.width,this.height);this.context.globalAlpha=1}if(this.displayObjects.length>0){for(var e=0;e<this.displayObjects.length;e++){var t=this.displayObjects[e];if(typeof t.render=="function"){t.render()}}}},setScale:function(){if(this.width>640){this.responsiveScale=1}else if(this.width<640&&this.width>320){this.responsiveScale=this.width/900}else if(this.width<=320){this.responsiveScale=this.width/640}},getAverages:function(){if(canvas.width>1e3){averageMoleculesOnScreen=200;extraMoleculesOnScreen=100}else if(canvas.width<1e3&&canvas.width>640){averageMoleculesOnScreen=120;extraMoleculesOnScreen=800}else if(canvas.width<640){averageMoleculesOnScreen=60;extraMoleculesOnScreen=60}},flash:function(){this.context.globalAlpha=.2;this.context.fillStyle="#FFFFFF";this.context.fillRect(0,0,this.width,this.height);this.context.globalAlpha=1},addChild:function(e){if(this.displayObjects.length>this.displayMax&&console&&console.warn){console.warn("Warning: There are currently more elements on the stage than reccomended.")}e.registerStage(this);this.displayObjects.push(e);this.numChildren=this.displayObjects.length},indexOf:function(e){return stage.displayObjects.indexOf(e)},removeChild:function(e){var t=this.indexOf(e);if(t!==-1){this.removeChildildrenAt(t,1)}},removeChildildrenAt:function(e,t){stage.displayObjects.splice(e,t);this.numChildren=this.displayObjects.length},dieSome:function(e,t){var n=t==undefined?0:t;for(var r=n;r<n+e-1;r++){var i=this.getChildAt(r);i.behavior=new DieOutBehavior}},getChildAt:function(e){return this.displayObjects[e]},setBehavior:function(e){for(var t=0;t<this.displayObjects.length;t++){this.displayObjects[t].behavior=e}},setShape:function(e,t,n,r){function l(){if(n){f=s>t}else{f=s<i.length+t}if(f){var e=r;if(n){if(s-e<t){e=t-s}}else{if(s+e>i.length+t){e=i.length+t-s}}if(n){s-=e}for(var o=0;o<e;o++){var u=i[s+o-t];var c=a.getChildAt(s+o);var h=u.x*900*a.responsiveScale;var p=u.y*600*a.responsiveScale;c.target(h,p);c.behavior=[];c.behavior.push(new MorphBehavior);c.behavior.push(new GrowBehavior);c.behavior.push(new ViberBehavior(Math.round(8*a.responsiveScale)));c.behavior.push(new ColorBehavior(Settings.particle.shape.color,15));c.radius=8-distance({x:u.x*900,y:u.y*600},{x:0,y:0})/40;c.radius*=a.responsiveScale}if(!n){s+=e}requestAnimationFrame(function(){l()})}else{return}}var i=e.molecules;for(var s=stage.numChildren-1;s>=0;s--){var o=stage.getChildAt(s);console.log(o.behavior.name);if(o.behavior.name="explode"){if(o.behavior.mustDie){o.die();console.log("fixed a molecule to die")}}}var u=this.numChildren-t-i.length;if(u>0){this.removeChildildrenAt(t+e.molecules.length,u)}else if(u<0){u=Math.abs(u);for(var s=0;s<u;s++){this.createShapeMolecule(t)}}else if(u==0){}var a=this;var f;var s=0;if(n){s=i.length+t}else{s=t}l()},createShapeMolecule:function(e){var t=e+Math.floor(Math.random()*(this.numChildren-e-1));var n=this.getChildAt(t);var r=new Molecule(n.x,n.y,n.radius);r.behavior=n.behavior;r.color=n.color;r.alpha=n.alpha;r.drawLines=false;this.addChild(r)},setTimeout:function(e,t){function r(){if(n<e){n++;requestAnimationFrame(function(){r()})}else{t()}}var n=0;r()}};var fireFireworks=false